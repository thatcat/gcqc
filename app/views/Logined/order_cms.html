<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>酸奶订单后台管理</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
            
	<link href="/public/stylesheets/bootstrap.css" rel="stylesheet" type="text/css" />
	<link href="/public/stylesheets/cms-index.css" rel="stylesheet" type="text/css" />
	<script src="/public/javascripts/jquery1.83.js" type="text/javascript"></script>
	<script src="/public/javascripts/bootstrap-tab.js" type="text/javascript"></script>
	<script>
	$(function () {
                    var log = function(s){
                    window.console && console.log(s)
                    }
                    $('.nav-tabs a:first').tab('show')               // first 默认显示第一个tab
                    $('a[data-toggle="tab"]').on('show', function (e) {
                        log(e)
                    })
                    $('a[data-toggle="tab"]').on('shown', function (e) {
                        log(e.target) // activated tab
                        log(e.relatedTarget) // previous tab
                    })
             })
	</script>
</head>



<body>
	<div class="header">
        <a href='#' class="logo-cms">国产汽车后台管系统</a>
		<div class="admin-login">
			当前登录：
            <a href="@{Logined.email()}" class="login"> ${user.username}</a>
            |
            <a href="@{Logined.logout()}" class="regist">注销</a>
		</div>
	</div>
	<div class="container">
<div class="nav-bar">
			<ul class="cms-lists">
				<li>
					<!-- 酸奶订单管理 -->
					<div class="order-cms">
						<a href="order_cms.html">车主认证管理</a>
					</div>
				</li>
				<li>
					<!-- 酸奶留言管理 -->
					<div class="words-cms">
						<a href="post_cms.html">留言管理</a>
					</div>
				</li>
				<li>
					<!-- 发表酸奶新闻 -->
					<div class="news-cms">
						<a href="#">小道消息管理</a>
					</div>
				</li>
			</ul>
		</div>

<!---------------------------------------------------------已处理的车主认证和还没有处理的车主认证开始----------------------------------------->
<!--<div class="tabbable tabs-left">-->
		<div class="tabbable tabs-top">
			<ul  class="nav nav-tabs">
                        			<li class="active"><a href="#unsolve" data-toggle="tab">未处理的认证</a></li>
                        			<li><a href="@{order_cms()}.#solved" data-toggle="tab">已处理认证</a></li>
                     		</ul>
                     		<!-- 下面是车主认证内容 -->
    			<div class="tab-content">
    				<!-- 待处理的认证从前台页面发送到这里 -->
                        			<div class="tab-pane active" id="unsolve">
                        				<div class="order-info">
                                            【 当前未处理的认证：<span>${userUndealList.size()}</span>单 】      					
                        				</div>
                        				<table id="tableSelect1">
                        					<tr>
                        						<th>标号</th>
                                                <th>姓名</th>
												<th>积分</th>
                                                <th>图片路径</th>
                                                <th>是否已是车主</th>												
												<th>申请认证日期</th>
												<th>认证内容</th>
                        					</tr>
                        					#{list items:userUndealList,as:'undealList'}
                                                <tr id="${undealList.id}">
                                                    <td>${undealList.id}</td>
                                                    <td>${undealList.username}</td>
													<td>${undealList.integration}</td>
                                                    <td><img src="${undealList.authPictiurePath}" />${undealList.authPictiurePath}</td>
                                                    <td>${undealList.isCarOwner} </td>
													<td>${undealList.applyDate} </td>
													<th><input type="text" id="authType" name="authType"></input></th>
													
                                                    <td><span class="badge btn-info btn highlight ml10" onclick="cancel_item(${undealList.id}, true);">认证通过</span></td>
													<td><span class="badge btn-info btn highlight ml10" onclick="cancel_item(${undealList.id},false);">认证不通过</span></td>
                                                </tr>
                                            #{/list}
                        				</table>
                        			</div>
                        			<!-- 已经处理的认证放在下面 -->
                        			<div class="tab-pane" id="solved">
                        				<div class="order-info">
                                            【 当前已处理的车主认证：<span>${userDealedList.size()}</span>单 】        					
                        				</div>
                        				<table>
                        					<caption></caption>
                        					<tr>
                        						<th>标号</th>
                                                <th>姓名</th>
                                                <th>图片路径</th>
                                                <th>是否已是车主</th>
												<th>认证内容</th>
												<th>认证日期</th>
                        					</tr>
                        					#{list items:userDealedList,as:'dealedList'}
                                                <tr id="${dealedList.id}">
                                                    <td>${dealedList.id}</td>
                                                    <td>${dealedList.username}</td>
													<td>${dealedList.authPictiurePath}</td>
                                                    <td>${dealedList.isCarOwner}</td>
													<td>${dealedList.authType}</td>
													<td>${dealedList.authDate}</td>
                                                    <td><button class="badge btn-info btn highlight ml10" onclick="dele_item(${dealedList.id})">撤销认证</button></td>
                                                </tr>
                                            #{/list}
                        				</table>
                        			</div>
            			</div>
		</div>
<!---------------------------------------------------------已处理的车主认证和还没有处理的车主认证结束----------------------------------------->
	</div>
            <script src="/public/javascripts/jquery1.83.js" type="text/javascript"></script>
             <script src="/public/javascripts/bootstrap-tab.js" type="text/javascript"></script>
             <script>
               function cancel_item(id, carOwner){
				   var authType = document.getElementById("authType").value;
                    if(confirm("你确定要标记为处理吗?")==1){
                        $.ajax({
                           type:'post',
                           url:'/Logined/deal_refresh',
                           data:{itemId:id, authType: authType, isCarOwner:carOwner} ,
                           dataType:'json',
                           success:function(data){
                               if(data.status==200){
                                   $("#"+id).hide(function(){alert("标记处理成功!");} );
                                    location.reload();
                               }else{
                                   alert("标记处理失败!");
                               }
                           },
                           error:function(){
                              alert("标记处理失败!");
                           }
                           })       
                    }
                }
                function dele_item(id){
                    if(confirm("你确定要撤销吗?")==1){
                        $.ajax({
                           type:'post',
                           url:'/Logined/auth_delete',
                           data:{
                               itemId:id
                           },
                           dataType:'json',
                           success:function(data){
                               if(data.status==200){
                                   $("#"+id).hide(function(){alert("撤销认证成功!");} );
                               }else{
                                   alert("撤销认证失败!");
                               }
                           },
                           error:function(){
                              alert("撤销认证失败!");
                           }
                           })       
                    }
                }
             </script>
</body>
</html>